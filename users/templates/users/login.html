{% extends "todo_apps/base.html" %}
{% load bootstrap5 %}
{% bootstrap_css %}
{% load widget_tweaks %}

{% block content %}
<style>
    .form-signin {
        width: 100%;
        max-width: 330px;
        padding: 15px;
        margin: 0 auto;
      }
      .form-signin .checkbox {
        font-weight: 400;
      }
      .form-signin .form-control {
        position: relative;
        box-sizing: border-box;
        height: auto;
        padding: 10px;
        font-size: 16px;
      }
      .form-signin .form-control:focus {
        z-index: 2;
      }
      .form-signin input[type="text"] {
        margin-bottom: -1px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
      }
      .form-signin input[type="password"] {
        margin-bottom: 10px;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
      }    
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0,0,0,0);
        white-space: nowrap;
        -webkit-clip-path: inset(50%);
        clip-path: inset(50%);
        border: 0;
    }
    #loader {
      border: 6px solid #f3f3f3;
      border-radius: 50%;
      border-top: 6px solid #3498db;
      width: 60px;
      height: 60px;
      -webkit-animation: spin 2s linear infinite; /* Safari */
      animation: spin 2s linear infinite;
      display: none;
      margin-left: 50%;
    }
    
    /* Safari */
    @-webkit-keyframes spin {
      0% { -webkit-transform: rotate(0deg); }
      100% { -webkit-transform: rotate(360deg); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
</style>

    {% if form.errors %}
    <p>Username and password isn't valid!</p>
    {% endif %}
    <div id="loader"></div>
    <form id="auth-form" class="form-signin text-center" hx-post="{% url 'users:login' %}">
    {% csrf_token %}
    <div>
        <h1><b><i>TaskiDoo</i>!</b></h1>
        <h5 class="font-weight-normal">Please sign in</h5>
        <div class="form-group mt-4">
            <label class="sr-only" for="{{ form.username.id_for_label }}">Login</label>
            {% render_field form.username class="form-control" placeholder="Login" type="text" %}

        </div>
        <div class="form-group">
            <label class="sr-only" for="{{ form.password.id_for_label }}">Password</label>
            {% render_field form.password class="form-control" placeholder="Password" type="password" %}
        </div>

    </div>
    <button class="btn btn-primary btn-lg btn-block" style="width: 300px; max-width: 300 px;" onclick="redirect()" name="submit">Sign In</button>
    <input type="hidden" name="next"  value="{% url 'todo_apps:tasks' %}" />
    <div class="mt-2">
    <a href="{% url 'users:register' %}">Create an account</a>  
    </div>
  </form>
  

  <script>
    var loader = document.getElementById('loader')
    var form = document.getElementById('auth-form')

    function redirect() {
      form.style.display = "none";
      loader.style.display = "block"; 
      setTimeout(() => {
        window.location.href="/tasks"}, 700); 
    }
  </script>
    
{% endblock content %}