{% load bootstrap5 %}
{% bootstrap_css %}
{% load widget_tweaks %}

{% block content %}
<nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark" aria-label="Main navigation">
  <div class="container-fluid">
      <a class="navbar-brand" href="{% url 'todo_apps:index' %}"><i><b>TaskiDoo</i>!</b></a>
      <button class="navbar-toggler p-0 border-0" type="button" id="navbarSideCollapse" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      </button>

      <div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link"></a>
            </li>
          <li class="nav-item">
          <a class="nav-link" href="{% url 'users:profile' %}">Profile</a>
          </li>
          <li class="nav-item">
          <a class="nav-link" href="#">Switch account</a>
          </li>
          <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-bs-toggle="dropdown" aria-expanded="false">Settings</a>
          <ul class="dropdown-menu" aria-labelledby="dropdown01">
              <li><a class="dropdown-item" href="#">Action</a></li>
              <li><a class="dropdown-item" href="#">Another action</a></li>
              <li><a class="dropdown-item" href="#">Something else here</a></li>
          </ul>
          </li>
      </ul>
      <ul class="navbar-nav me-0 mb-5 mb-lg-0">
      {% if user.is_authenticated %} 
      <li class="nav-item me-2">
      <a class="nav-link">Welcome, {{ user.username }}.</a>
      </li>   
      <li class="nav-item me-4">
          <a class="nav-link" href="{% url 'users:logout' %}">Logout</a>
      </li>
      {% else %}    
      <li class="nav-item me-4">
          <a class="nav-link" href="{% url 'users:login' %}">Login</a>
      </li>
      <li class="nav-item me-4">
          <a class="nav-link" href="{% url 'users:register' %}">Register</a>
      </li>
      </ul>
      {% endif %}
      </div>
  </div>
  </nav>

    <div class="form-control mt-5 p-4">
    <form style="margin: auto; max-width:700px;" class="form-group text-center" hx-post="{% url 'users:profile' %}">
        {% csrf_token %}
        
        <h5 class="font-weight-normal mb-3">Edit profile</h5>

        <div class="form-group row mb-2">
          <label for="login" class="col-sm-2 col-form-label"><b>Login</b></label>
          <div class="col-sm-10">
              {% render_field user_form.username class="form-control" type="text" id="login" %}
          </div>
        </div>

        <div class="form-group row mb-2">
          <label for="email" class="col-sm-2 col-form-label"><b>Email</b></label>
          <div class="col-sm-10">
              {% render_field user_form.email class="form-control" type="email" id="email" %}
          </div>
        </div>

        <div class="form-group row mb-2">
          <label for="firstname" class="col-sm-2 col-form-label"><b>First name</b></label>
          <div class="col-sm-10">
              {% render_field user_form.first_name class="form-control" type="text" id="firstname" %}
          </div>
        </div>

        <div class="form-group row mb-4">
          <label for="lastname" class="col-sm-2 col-form-label"><b>Last name</b></label>
          <div class="col-sm-10">
              {% render_field user_form.last_name class="form-control" type="text" id="lastname" %}
          </div>
        </div>

        <div class="form-group row mb-2">
          <a href="{% url 'users:change_password' %}" class="text-decoration-none">Change your password</a>
        </div>

        <button class="btn btn-primary btn-block mt-3"  onclick="reloader()" name="submit">Update profile</button>
    </form>
</div>

<script>

    function reloader() {
      setTimeout(() => {
        window.location.href="/users/profile"}, 1); 
    }
  </script>
    <!-- CSRF request in the headers -->

{% endblock content %} 
<script src="https://unpkg.com/htmx.org@1.7.0"></script> 

<script>
  document.body.addEventListener('htmx:configRequest', (e) => {
    e.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
    })
</script>